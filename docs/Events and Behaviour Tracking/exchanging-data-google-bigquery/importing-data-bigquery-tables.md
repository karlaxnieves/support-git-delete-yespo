---
title: Importing Data from the BigQuery Tables
excerpt: ''
deprecated: false
hidden: false
metadata:
  title: Importing Data from the BigQuery Tables | Yespo Guide
  description: >-
    Learn how to import data from BigQuery to Yespo to personalize your
    communication with your customers
  robots: index
next:
  description: ''
---
Letâ€™s consider how to create a BigQuery data source and use it for segmentation and personalization in Yespo.

## Configuring a Data Source for Importing Data to Yespo

1\. Go to your profile â†’ _Settings â†’ Data sources_, click _New data source_, and select _External data source_.

[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/317e4962af092b02ed08857d8a0a8762d5bac445af4eadfab1c20de377779368-image3.webp",
        "External data source",
        "External data source"
      ],
      "align": "center",
      "sizing": "80% "
    }
  ]
}
[/block]


2\. Select [the created connector](https://docs.yespo.io/docs/google-bigquery-integration#setting-up-bigquery-connector).

[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/175e8f013b44a0a5ce038abf965feb916ca80ee109a45b97b01fa7979d97fdaa-image2.webp",
        "Select connector",
        "Select connector"
      ],
      "align": "center",
      "sizing": "80% "
    }
  ]
}
[/block]


3\. Specify the dataset and table, and enter a source name (also you can specify filters for forming the message content here). Click _Save_.

[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/54dcd91bb2be74baa31639227a967b279551d836466b7ba8ab1e7b415fd8d678-image5.webp",
        "Save",
        "Save"
      ],
      "align": "center",
      "sizing": "80% "
    }
  ]
}
[/block]


## Using BigQuery Data for Personalized E-commerce CampaignsÂ 

BigQuery data can drive highly targeted campaigns by dynamically referencing customer-specific details such as purchase history, engagement levels, and preferred product categories. Hereâ€™s how to incorporate this data into your e-commerce campaigns.

### 1\. Bulk Campaign with BigQuery Data

Suppose you want to run a campaign targeting customers who recently purchased specific product categories, offering a personalized discount code. Hereâ€™s an example data setup for a contact, `jdoe@example.com` using the _discount\_codes_ data source:

```json
{
Â  "data": {
Â  Â  "discount_codes": [
Â  Â  Â  {
Â  Â  Â  Â  "id": "3",
Â  Â  Â  Â  "email": "jdoe@example.com",
Â  Â  Â  Â  "name": "John Doe",
Â  Â  Â  Â  "recent_purchase_category": "Home Appliances",
Â  Â  Â  Â  "discount_code": "SAVE20-HOME",
Â  Â  Â  Â  "expiry_date": "2023-12-31T23:59:59Z"
Â  Â  Â  }
Â  Â  ]
Â  }
}
```

You can reference each field in the message using a [Velocity syntax](https://docs.yespo.io/docs/introduction-to-velocity) as follows:

- **Directly with parameters** (if you know the array has a fixed length):

```json
- $!data.get('discount_codes').get(0).get('name')  
  $!data.get('discount_codes').get(0).get('discount_code')
```

- **Using a loop** (ideal for flexible-length arrays):

```json
- # foreach($code in $!data.get('discount_codes'))

  Â  $!code.get('name')  
  Â  $!code.get('discount_code')  
  #end
```

### 2\. Triggered Campaign Based on Purchase Milestones

To send personalized messages when customers reach purchase milestones, such as their 50th order:

1\. [**Create a dynamic segment**](https://docs.yespo.io/docs/how-add-dynamic-segment) that includes customers meeting specific purchase conditions (for example, the 50th purchase was made).

2\. [**Set up a regular workflow**](https://docs.yespo.io/docs/how-launch-regular-workflow-segment-support) for this segment.

When the workflow triggers for contacts matching specified conditions, the system creates an event. The event name is generated by combining the static prefix _regularEventType_ with the segment ID, resulting in a name like _regularEventType-170531841_.

This event includes contact information, such as the contact ID in Yespo (_contactId_), email address (_emailAddress_), and data pulled from an external table. Each field from the table is converted into a key and placed within an array, labeled with a numeric name that matches the data source ID.

[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/5840973f39b668d0aca4a7707e609f53fface079c38e2a0781bd47b6eccc2a92-image4.webp",
        "Data source ID",
        "Data source ID"
      ],
      "align": "center",
      "sizing": "80% "
    }
  ]
}
[/block]


This array is then serialized and stored as a string in the jsonParam field. An example event body might look like this:

```json
{
Â  "params": [
Â  Â  {
Â  Â  Â  "name": "contactId",
Â  Â  Â  "value": "123456789"
Â  Â  },
Â  Â  {
Â  Â  Â  "name": "jsonParam",
Â  Â  Â  "value": "{\"1043\":[{\"id\":2,\"email\":\"shopper@example.com\",\"name\":\"Jordan Lee\",\"lastPurchaseDate\":\"2023-10-15T10:00:00Z\",\"purchaseFrequency\":50,\"averageBasketValue\":120}]}"
Â  Â  },
Â  Â  {
Â  Â  Â  "name": "emailAddress",
Â  Â  Â  "value": "shopper@example.com"
Â  Â  }
Â  ]
}
```

When extracting data to a message, the data source number in Yespo is used as the name of the array:

```json
{
Â  "data": {
Â  Â  "1043": [
Â  Â  Â  {
Â  Â  Â  Â  "id": "2",
Â  Â  Â  Â  "email": "shopper@example.com",
Â  Â  Â  Â  "name": "Jordan Lee",
Â  Â  Â  Â  "lastPurchaseDate": "2023-10-15T10:00:00Z",
Â  Â  Â  Â  "purchaseFrequency": 50,
Â  Â  Â  Â  "averageBasketValue": 120
Â  Â  Â  }
Â  Â  ]
Â  }
}
```

If you know that thereâ€™s a single entry in the 1043 array, you can access fields directly:

```json
$!data.get('1043').get(0).get('name')
$!data.get('1043').get(0).get('lastPurchaseDate')
$!data.get('1043').get(0).get('purchaseFrequency')
$!data.get('1043').get(0).get('averageBasketValue')
```

If the 1043 array could contain multiple entries, use a loop to extract all values dynamically:

```json
#foreach($entry in $!data.get('1043'))
Â  $!entry.get('name')
Â  $!entry.get('lastPurchaseDate')
Â  $!entry.get('purchaseFrequency')
Â  $!entry.get('averageBasketValue')
#end
```

## Creating a Dynamic Segment Using BigQuery Parameters

1\. In _Contacts â†’ Segments_, create a new dynamic segment.

2\. Select the conditions for inclusion in the segment. In the condition options, click the source name, then the option name, and set the condition. For example, Â purchaseFrequency â†’ equalsÂ â†’ 50.

[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/f6ba0dfbb4ff9e0be29423a47227db512ba53f386ebfb8a554c840b7984e4cec-image1-1.webp",
        "Dynamic segment",
        "Dynamic segment"
      ],
      "align": "center",
      "sizing": "80% "
    }
  ]
}
[/block]


> ðŸ“˜ Note
> 
> Connection to the external database doesnâ€™t presuppose contact import. Segmentation is only available for contacts that exist both in your Yespo account and in the external database. Synchronize and update contacts before creating campaigns.